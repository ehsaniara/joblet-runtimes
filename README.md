# 📦 Joblet Runtime Registry

Pre-built runtime environments for [Joblet](https://github.com/joblet/joblet) - so you can run jobs with **exactly** the dependencies you need, every time.

## 🎯 Why This Exists

Running distributed jobs is tricky when different jobs need different library versions. You might need:
- 🤖 PyTorch 2.1 with CUDA for GPU training
- 📊 NumPy 1.26 for data processing
- ☕ OpenJDK 21 for your Java app
- ⚡ GraalVM for native compilation

Instead of managing dependencies manually on each machine, just pick a runtime and go. All dependencies are pre-built, versioned, and reproducible.

Want another runtime? [Create one](#adding-a-runtime) - it's just a manifest file and setup scripts.

## 🚀 Quick Start

**Prerequisites:** You need [Joblet](https://github.com/joblet/joblet) installed with the `rnx` CLI.

### 📥 Installing Runtimes

```bash
# Install a specific version (recommended for production)
rnx runtime install python-3.11-pytorch-cuda@1.0.0

# Install latest version (just omit the @version)
rnx runtime install openjdk-21

# See what's installed
rnx runtime list
```

**Version notation:** We use `@` like npm - `runtime@version`. If you skip the `@version` part, you get `@latest`.

### ▶️ Running Jobs

```bash
# Train a model with GPU
rnx job run --runtime=python-3.11-pytorch-cuda@1.0.0 --gpu=1 python train.py

# Run CPU-based data processing
rnx job run --runtime=python-3.11-ml --cpu=4 --memory=8192 python analyze.py

# Run a Java application
rnx job run --runtime=openjdk-21@1.0.0 java -jar myapp.jar

# Compile to native binary with GraalVM
rnx job run --runtime=graalvmjdk-21@1.0.0 native-image -jar myapp.jar
```

## ⚙️ How It Works

1. 🏷️ You push a git tag like `v1.0.0`
2. 🔄 GitHub Actions **automatically updates all `manifest.yaml` files** to version `1.0.0`
3. 🔨 Builds all runtimes and captures exact package versions
4. 📦 Creates a GitHub Release with downloadable packages
5. 🔐 Auto-generates `registry.json` with checksums for verification
6. 💾 Commits updated manifests, registry, and version locks back to the repo
7. 📥 Users install via `rnx` - downloads, verifies checksums, installs

**Version sync:** The git tag version (e.g., `v1.2.3`) automatically updates all runtime `manifest.yaml` files to `version: 1.2.3`. This ensures consistency across all runtimes in a release.

**What gets committed:**

- `manifest.yaml` - What packages to install (manually maintained)
- `versions.lock` - Actual installed versions from build (auto-generated by CI)
- `registry.json` - Download URLs and checksums (auto-generated by CI)
- Binary packages (`.tar.gz`) - Uploaded to GitHub Releases only (not in git)

Everything is reproducible because we lock exact versions (with SHA256 checksums) of every dependency.

## ➕ Adding a Runtime

Want to add a new runtime? Here's how:

1. **Create the directory:**
   ```bash
   mkdir -p runtimes/my-runtime
   ```

2. **Add `manifest.yaml`:**
   ```yaml
   # Joblet Runtime: my-runtime
   # For use with Joblet - https://github.com/joblet/joblet

   name: my-runtime
   version: 1.0.0  # Auto-updated by CI/CD from git tag
   description: What this runtime includes

   platforms:
     - ubuntu-amd64

   packages:
     - package1==1.0.0
     - package2==2.0.0
   ```

   **Note:** The version field gets auto-updated when you push a git tag, so you can keep it at `1.0.0` during development.

3. **Add setup scripts:**
   - `setup.sh` - Detects platform and delegates
   - `setup-ubuntu-amd64.sh` - Platform-specific install

4. **Push and tag:**
   ```bash
   git add runtimes/my-runtime
   git commit -m "Add my-runtime"
   git push origin main
   git tag v1.1.0
   git push origin v1.1.0
   ```

5. ✅ **Done!** GitHub Actions builds it, creates the release, and users can install it.

See existing runtimes in the `runtimes/` directory for examples.

## ⚙️ Configuration

Point Joblet to this registry by adding to `~/.rnx/config.yaml`:

```yaml
runtimes:
  registries:
    - name: official
      url: https://github.com/joblet/joblet-runtimes
      enabled: true
```

## 📚 Documentation

**New to runtimes?** Check out our comprehensive guides:

- **[Runtime Overview](docs/RUNTIME_OVERVIEW.md)** - How runtimes work, the registry system, version management
- **[Creating Runtimes](docs/CREATING_RUNTIMES.md)** - Step-by-step guide to building your own runtime
- **[Releasing Runtimes](docs/RELEASING.md)** - How to release individual or bulk runtime updates
- **[Docs Index](docs/README.md)** - Full documentation index with quick reference

## 🎁 Available Runtimes

| Runtime                    | Latest Version | Description                                                 |
|----------------------------|----------------|-------------------------------------------------------------|
| `python-3.11`              | 1.3.1          | Basic Python 3.11 runtime                                   |
| `python-3.11-ml`           | 1.3.1          | Python 3.11 with ML libraries (NumPy, Pandas, Scikit-learn) |
| `python-3.11-pytorch-cuda` | 1.3.1          | PyTorch 2.1.0 + CUDA 11.8 for GPU deep learning             |
| `openjdk-21`               | 1.3.1          | OpenJDK 21 LTS with development tools                       |
| `graalvmjdk-21`            | 1.3.1          | GraalVM CE 21 with native-image for AOT compilation         |

See [registry.json](registry.json) for all available versions.

## ℹ️ Project Info

- 👤 **Maintainer:** Jay Ehsaniara
- 📄 **License:** MIT
- 🚀 **Main Project:** [Joblet](https://github.com/joblet/joblet) - Distributed job execution with cgroups isolation
- 📚 **Documentation:** [docs/](docs/) - Comprehensive guides and references

